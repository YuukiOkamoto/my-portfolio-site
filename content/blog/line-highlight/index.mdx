---
title: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®æŒ‡å®šè¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã›ã‚‹
date: '2020-06-26T16:00:00Z'
description: ''
featured: false
cover: ./cover.jpeg
tags:
  - æŠ€è¡“ãƒ–ãƒ­ã‚°
  - React
---

import CodeBlock from '../../../src//components/MDXComponents/CodeBlock';
import Callout from '../../../src/components/widgetComponents/Callout';
import Collapse from '../../../src/components/widgetComponents/Collapse';
import ExternalLink from '../../../src/components/widgetComponents/ExternalLink';
import PostLink from '../../../src/components/widgetComponents/PostLink';

## ã¤ãã£ãŸã‚‚ã®

æŠ€è¡“ãƒ–ãƒ­ã‚°ã‚’æ›¸ã„ã¦ã„ã‚‹ã¨ãã«ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®æŒ‡å®šè¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ãŸã„ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚  
ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ã©ã“ã‚’èª¬æ˜ã—ã¦ã„ã‚‹ã®ã‹èª­ã¿ã‚„ã™ãã—ãŸã„ã¨æ€ã£ãŸã‹ã‚‰ã§ã™ï¼

ãŸã¨ãˆã°`.mdx`ãƒ•ã‚¡ã‚¤ãƒ«ã§`line={1,4-6}`ã¨è¡Œã‚’æŒ‡å®šã™ã‚‹ã¨ã€

<CodeBlock className='language-mdx'>
  {`
å‰¯ä½œç”¨ (effect) ãƒ•ãƒƒã‚¯ ã«ã‚ˆã‚Šã€é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å‰¯ä½œç”¨ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
\`\`\`js line={1,4-6}
import React, { useState, useEffect } from 'react'\;
\  
function Example() {
  const [count, setCount] = useState(0);
  \  
  useEffect(() => {
    document.title = \`You clicked \${count} times\`\;
  })\;
  \  
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  )\;
}
\`\`\`
  `}
</CodeBlock>

ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯éƒ¨åˆ†ã¯ 1 è¡Œç›®ã¨ 4~6 è¡Œç›®ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã¾ã™ã€‚

```js line={1,6-8}
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

## å®Ÿè£…

### ```ã§è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”¨æ„

ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã®\`\`\`ã‚’ä½¿ã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹è¦‹ãŸç›®ã‚’ã€MDXProvider ã‚’ä½¿ã£ã¦å¤‰ãˆãŸã„ã¨æ€ã„ã¾ã™ã€‚

`{ code: <è¡¨ç¤ºã—ãŸã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ /> }`ã‚’  
MDXProvider ã® state ã§ã‚ã‚‹ components ã«æ¸¡ã™ã“ã¨ã§ã€  
\`\`\`ã§è¡¨ç¤ºã•ã‚Œã‚‹è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```jsx title=MDXProviderä¾‹
import { MDXProvider } from '@mdx-js/react';

const CodeBlock = props => <pre style={{ background: 'gray' }} {...props} />;

const components = {
  code: CodeBlock,
};

export const wrapRootElement = ({ element }) => (
  <MDXProvider components={components}>{element}</MDXProvider>
);
```

MDXProvider ã«ã¤ã„ã¦è©³ç´°ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§ãã ã•ã„ã€‚

<PostLink to='/blog/mdx-provider/' />

è‡ªåˆ†ã®å ´åˆã¯ã€  
`CodeBlock`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã§ã€`Highlight`ã¨ã„ã†è‰²ä»˜ã‘ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

<Collapse>

<>CodeBlockã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</>

```jsx title=CodeBlockã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ line={45,51}
import React, { useState } from 'react';

import EditableHighlight from './EditableHighlight';
import Highlight from './Highlight';
import { LiveError, LivePreview, LiveProvider } from './react-live';

const CodeBlock = ({
  className,
  live,
  isManual,
  demo,
  title,
  line,
  children,
  ...props
}) => {
  const [code, setCode] = useState(children.trim());

  const language = className && className.replace('language-', '');

  if (language === 'jsx' && live) {
    return (
      <LiveProvider
        language={language}
        code={code}
        isManual={isManual}
        {...props}
      >
        <LivePreview />
        <EditableHighlight code={code} setCode={setCode} title={title} />
        <LiveError />
      </LiveProvider>
    );
  }

  if (demo) {
    return (
      <LiveProvider
        language={language}
        code={code}
        isManual={isManual}
        {...props}
      >
        <LivePreview />
        <Highlight title={title} code={code} language={language} line={line} />
      </LiveProvider>
    );
  }

  return (
    <Highlight title={title} code={code} language={language} line={line} />
  );
};

export default CodeBlock;
```

<ExternalLink href='https://github.com/YuukiOkamoto/my-blog/blob/master/src/components/MDXComponents/CodeBlock/index.js'>
  GitHub
</ExternalLink>

</Collapse>

<Collapse>

<>Highlightã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</>

```jsx title=Highlightã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ line={5,22-31,33-42,79,101}
import React, { useState } from 'react';
import PrismHighlight, { defaultProps } from 'prism-react-renderer';
import { useTheme, Box } from '@chakra-ui/core';
import theme from 'prism-react-renderer/themes/vsDark';
import rangeParser from 'parse-numeric-range';

import { generateAlphaColors } from '../../../theme/colors-utils';

import CopyButton from './CopyButton';
import Title from './Title';

const highlightStyle = {
  backgroundColor: '#2D2D2D',
  fontFamily: 'Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace',
  fontSize: [12, 14],
  overflow: 'auto',
  py: 5,
  float: 'left',
  minWidth: 'full',
};

const calculateLinesToHighlight = meta => {
  const RE = /{([\d,-]+)}/;
  if (RE.test(meta)) {
    const strLineNumbers = RE.exec(meta)[1];
    const lineNumbers = rangeParser(strLineNumbers);
    return index => lineNumbers.includes(index + 1);
  } else {
    return () => false;
  }
};

const Line = ({ shouldHighlight, ...props }) => {
  const highlightProps = shouldHighlight && {
    d: 'block',
    bg: 'gray.700',
    borderLeftWidth: '.5rem',
    borderLeftColor: 'purple.200',
    px: '3',
  };
  return <Box d='table-cell' px='5' {...props} {...highlightProps} />;
};

const Word = ({ focusedWord, setFocusedWord, content, tokenProps }) => {
  const [delayHandler, setDelayHandler] = useState(null);
  const { colors } = useTheme();

  const orangeAlpha = generateAlphaColors(colors.orange[100]);

  const handleMouseEnter = word => {
    setDelayHandler(
      setTimeout(() => {
        setFocusedWord(word);
      }, 500)
    );
  };

  const handleMouseLeave = () => {
    setFocusedWord('');
    clearTimeout(delayHandler);
  };

  const shouldHighlighted = word => focusedWord === word && word.length > 1;

  return (
    <Box
      as='span'
      bg={shouldHighlighted(content) && orangeAlpha[400]}
      onMouseEnter={() => handleMouseEnter(content)}
      onMouseLeave={handleMouseLeave}
      {...tokenProps}
    />
  );
};

const Highlight = ({ title, code, language, line }) => {
  const [focusedWord, setFocusedWord] = useState('');

  const shouldHighlightLine = calculateLinesToHighlight(line);

  return (
    <Box my='8' mx={['-24px', '-24px', '0']} rounded='md'>
      {title && <Title>{title}</Title>}
      <Box position='relative'>
        <PrismHighlight
          {...defaultProps}
          theme={theme}
          code={code}
          language={language}
        >
          {({ className, style, tokens, getLineProps, getTokenProps }) => (
            <Box overflowX='auto'>
              <Box
                as='pre'
                className={className}
                {...highlightStyle}
                style={{ ...style }}
              >
                {tokens.map((line, i) => (
                  <div key={i} {...getLineProps({ line, key: i })}>
                    <Line shouldHighlight={shouldHighlightLine(i)}>
                      {line.map((token, key) => (
                        <Word
                          key={key}
                          focusedWord={focusedWord}
                          setFocusedWord={setFocusedWord}
                          content={token.content.trim()}
                          tokenProps={getTokenProps({ token, key })}
                        />
                      ))}
                    </Line>
                  </div>
                ))}
              </Box>
            </Box>
          )}
        </PrismHighlight>
        <CopyButton code={code} />
      </Box>
    </Box>
  );
};

export default Highlight;
```

<ExternalLink href='https://github.com/YuukiOkamoto/my-blog/blob/master/src/components/MDXComponents/CodeBlock/Highlight.js'>
  GitHub
</ExternalLink>

</Collapse>

ã“ã®`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æŒ‡å®šã—ãŸè¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ã¦ã„ã¾ã™ã€‚

### æŒ‡å®šã—ãŸè¡Œã‚’å—ã‘å–ã‚‹

MDXProvider ã® components ã® code ã«æŒ‡å®šã—ãŸ`CodeBlock`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€  
MDX å†…ã§`line={1,3-5}`ã®ã‚ˆã†ã«æŒ‡å®šã—ãŸ`{1,3-5}`ã¨ã„ã†æ–‡å­—åˆ—ã‚’`line`props ã§å—ã‘å–ã‚Œã¾ã™ã€‚

<CodeBlock className='language-mdx' title='mdx'>
  {`
\`\`\`js line={1,3-5}
console.log('macho')\;
console.log('macho!')\;
console.log('macho!!')\;
console.log('macho!!!')\;
console.log('macho!!!!')\;
console.log('macho!!!!!')\;
\`\`\`
  `}
</CodeBlock>

ãã—ã¦ã€`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚

```jsx
<Highlight title={title} code={code} language={language} line={line} />
```

<Collapse>

<>ã‚‚ã†ä¸€åº¦ã€CodeBlockã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</>

```jsx title=CodeBlockã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ line={45,51}
import React, { useState } from 'react';

import EditableHighlight from './EditableHighlight';
import Highlight from './Highlight';
import { LiveError, LivePreview, LiveProvider } from './react-live';

const CodeBlock = ({
  className,
  live,
  isManual,
  demo,
  title,
  line,
  children,
  ...props
}) => {
  const [code, setCode] = useState(children.trim());

  const language = className && className.replace('language-', '');

  if (language === 'jsx' && live) {
    return (
      <LiveProvider
        language={language}
        code={code}
        isManual={isManual}
        {...props}
      >
        <LivePreview />
        <EditableHighlight code={code} setCode={setCode} title={title} />
        <LiveError />
      </LiveProvider>
    );
  }

  if (demo) {
    return (
      <LiveProvider
        language={language}
        code={code}
        isManual={isManual}
        {...props}
      >
        <LivePreview />
        <Highlight title={title} code={code} language={language} line={line} />
      </LiveProvider>
    );
  }

  return (
    <Highlight title={title} code={code} language={language} line={line} />
  );
};

export default CodeBlock;
```

<ExternalLink href='https://github.com/YuukiOkamoto/my-blog/blob/master/src/components/MDXComponents/CodeBlock/index.js'>
  GitHub
</ExternalLink>

</Collapse>

### å—ã‘å–ã£ãŸè¡Œã‹ã‚‰ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã¹ãã‹åˆ¤åˆ¥ã™ã‚‹

å—ã‘å–ã£ãŸè¡Œã®`{1,3-5}`ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’å—ã‘å–ã‚‹ã€  
`calculateLinesToHighlight`ã¨ã„ã†é«˜éšé–¢æ•°ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```js title=calculateLinesToHighlighté–¢æ•°
const calculateLinesToHighlight = meta => {
  const RE = /{([\d,-]+)}/;
  if (RE.test(meta)) {
    const strLineNumbers = RE.exec(meta)[1];
    const lineNumbers = rangeParser(strLineNumbers);
    return index => lineNumbers.includes(index + 1);
  } else {
    return () => false;
  }
};
```

ã“ã®å…¬é–‹é–¢æ•°ãŒè¿”ã™é–¢æ•°ã¯ã€  
è¡Œç•ªå·ã‚’æ¸¡ã›ã°ãã‚ŒãŒæŒ‡å®šè¡Œã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹çœŸå½å€¤ã§è¿”ã™ã‚‚ã®ã§ã™ã€‚

```js title=è¡Œç•ªå·ã‚’ç§æŒ‡å®šè¡Œã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹çœŸå½å€¤ã§è¿”ã™é–¢æ•°ã‚’ä½œæˆ
const shouldHighlightLine = calculateLinesToHighlight(line);
```

ãã‚Œã‚’ã€å—ã‘å–ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’è¡Œã”ã¨ã«ãƒ«ãƒ¼ãƒ—ã§å›ã—ã¦ã„ã‚‹ç®‡æ‰€ã§ä½¿ã„ã€ãã®è¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã¹ãã‹åˆ¤å®šã—ã¦ã„ã¾ã™ã€‚

```jsx

{tokens.map((line, i) => (
  <div key={i} {...getLineProps({ line, key: i })}>
    <Line shouldHighlight={shouldHighlightLine(i)}>
      ...
```

### ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã¹ãè¡Œã®å ´åˆã€styleã‚’åŠ ãˆã‚‹

ã‚ã¨ã¯ã€`Line`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®`shouldHighlight`ãŒtrueã®å ´åˆã«styleã‚’åŠ ãˆã‚‹ã ã‘ã§ã™ï¼

```jsx title=Lineã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const Line = ({ shouldHighlight, ...props }) => {
  const highlightProps = shouldHighlight && {
    d: 'block',
    bg: 'gray.700',
    borderLeftWidth: '.5rem',
    borderLeftColor: 'purple.200',
    px: '3',
  };
  return <Box d='table-cell' px='5' {...props} {...highlightProps} />;
};
```

<Collapse>

<>ã‚‚ã†ä¸€åº¦ã€Highlightã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</>

```jsx title=Highlightã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ line={22-31,33-42,79,101}
import React, { useState } from 'react';
import PrismHighlight, { defaultProps } from 'prism-react-renderer';
import { useTheme, Box } from '@chakra-ui/core';
import theme from 'prism-react-renderer/themes/vsDark';
import rangeParser from 'parse-numeric-range';

import { generateAlphaColors } from '../../../theme/colors-utils';

import CopyButton from './CopyButton';
import Title from './Title';

const highlightStyle = {
  backgroundColor: '#2D2D2D',
  fontFamily: 'Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace',
  fontSize: [12, 14],
  overflow: 'auto',
  py: 5,
  float: 'left',
  minWidth: 'full',
};

const calculateLinesToHighlight = meta => {
  const RE = /{([\d,-]+)}/;
  if (RE.test(meta)) {
    const strLineNumbers = RE.exec(meta)[1];
    const lineNumbers = rangeParser(strLineNumbers);
    return index => lineNumbers.includes(index + 1);
  } else {
    return () => false;
  }
};

const Line = ({ shouldHighlight, ...props }) => {
  const highlightProps = shouldHighlight && {
    d: 'block',
    bg: 'gray.700',
    borderLeftWidth: '.5rem',
    borderLeftColor: 'purple.200',
    px: '3',
  };
  return <Box d='table-cell' px='5' {...props} {...highlightProps} />;
};

const Word = ({ focusedWord, setFocusedWord, content, tokenProps }) => {
  const [delayHandler, setDelayHandler] = useState(null);
  const { colors } = useTheme();

  const orangeAlpha = generateAlphaColors(colors.orange[100]);

  const handleMouseEnter = word => {
    setDelayHandler(
      setTimeout(() => {
        setFocusedWord(word);
      }, 500)
    );
  };

  const handleMouseLeave = () => {
    setFocusedWord('');
    clearTimeout(delayHandler);
  };

  const shouldHighlighted = word => focusedWord === word && word.length > 1;

  return (
    <Box
      as='span'
      bg={shouldHighlighted(content) && orangeAlpha[400]}
      onMouseEnter={() => handleMouseEnter(content)}
      onMouseLeave={handleMouseLeave}
      {...tokenProps}
    />
  );
};

const Highlight = ({ title, code, language, line }) => {
  const [focusedWord, setFocusedWord] = useState('');

  const shouldHighlightLine = calculateLinesToHighlight(line);

  return (
    <Box my='8' mx={['-24px', '-24px', '0']} rounded='md'>
      {title && <Title>{title}</Title>}
      <Box position='relative'>
        <PrismHighlight
          {...defaultProps}
          theme={theme}
          code={code}
          language={language}
        >
          {({ className, style, tokens, getLineProps, getTokenProps }) => (
            <Box overflowX='auto'>
              <Box
                as='pre'
                className={className}
                {...highlightStyle}
                style={{ ...style }}
              >
                {tokens.map((line, i) => (
                  <div key={i} {...getLineProps({ line, key: i })}>
                    <Line shouldHighlight={shouldHighlightLine(i)}>
                      {line.map((token, key) => (
                        <Word
                          key={key}
                          focusedWord={focusedWord}
                          setFocusedWord={setFocusedWord}
                          content={token.content.trim()}
                          tokenProps={getTokenProps({ token, key })}
                        />
                      ))}
                    </Line>
                  </div>
                ))}
              </Box>
            </Box>
          )}
        </PrismHighlight>
        <CopyButton code={code} />
      </Box>
    </Box>
  );
};

export default Highlight;
```

<ExternalLink href='https://github.com/YuukiOkamoto/my-blog/blob/master/src/components/MDXComponents/CodeBlock/Highlight.js'>GitHub</ExternalLink>

</Collapse>

<Callout emoji='ğŸ¥°'>ä»¥ä¸Šã§ã™ï¼ã‚·ãƒ³ãƒ—ãƒ«ã«å°‘ã—ãšã¤æ”¹å–„ã—ã¦ã„ãã®ã¯æ¥½ã—ã„ã®ã§ã€ãœã²çš†ã•ã‚“ã‚‚è‡ªä½œæŠ€è¡“ãƒ–ãƒ­ã‚°ãƒ©ã‚¤ãƒ•ã‚’ï¼</Callout>